## time2root


### Structure of the code
The code consists of two sections:

* The engine **time2root**
* The visual part **visualizer**
* Some additional **utilities**

This seperation allows for an automated processing of large amount of data e.g. by using a shell script over several directories without user interaction. The resulting files which contain already calculated spectra, can be viewed with the visualizer in a second step.

#### The engine

This code accepts time domain data with the format of IQT, TIQ and CSV files. The input filename should have the corresponding extentions. IQT files are created by the RSA3000 series of Tektronix spectrum analyzers, whereas TIQ files are generated by the RSA5000 and newer models. Time domain files in form of a CSV file are usually produced by most modern oscilloscopes e.g. the LeCroy WaveRunner. For other oscilloscopes please check the file name format.

The code can creates following histograms and store them in a single binary ROOT file. The information in the root file is stored in **directories** make a clear structure. The binary root file can contain some or all of the histograms listed below. If the histograms exist, they will **not** be overwritten. Titles of the histogram contain the file basename.


| histogram | Description |
| ----- | ------ |
| RSA30_mag | IQT time domain magnitude |
| RSA30_phs | IQT time domain phase |
| RSA30_mtpsd2,4,6,8 or 10 | IQT multitaper estimation using FN implementation, showing the number of tapers|
| RSA30_fft | IQT standard FFT using FFTW|
| RSA51_mag | TIQ time domain magnitude |
| RSA51_phs | TIQ time domain phase |
| RSA51_mtpsd2,4,6,8 or 10 | TIQ multitaper estimation using XC implementation, showing the number of tapers|
| RSA51_fft | TIQ Standard FFT using FFTW |
| RSA52_mag | TIQ time domain magnitude |
| RSA52_phs | TIQ Itime domain phase |
| RSA52_mtpsd2,4,6,8 or 10 | TIQ multitaper estimation using XC implementation, showing the number of tapers|
| RSA52_fft | TIQ Standard FFT using FFTW |
| Oscil_C1 | CSV file time domain data channel one |
| Oscil_C2 | CSV file time domain data channel two |
| Oscil_C3 | CSV file time domain data channel three |
| Oscil_C4 | CSV file time domain data channel four |

In addition, instances of user-defined class *Header*, used as containers for some important information in the IQT/TIQ file header, are saved to the same ROOT file. Later on users can retrieve the values by *Getter* methods after the ROOT file is loaded from the disk. In the above list, **time2root** automatically decides whether the histogram name is prefixed by RSA51 or RSA52, by checking the *serial number* of the device. So there is no need to take care of that manually. Possible running commands are:

Syntax:

	./time2root output_filename input_filename

or

	./time2root root_filename time_filename towrite
	
or

	./time2root root_filename time_filename towrite number_of_tapers
	
By choosing one of the syntaxes above, you can control the output of the engine. The first syntax chooses the default behaviour. It calculates the Mutitaper PSD using 6 Tapers, stores them together with the header into the file.

The second syntax provides a possibility to choose what additional histograms should be written to the file by formatting the string called **towrite**, which **MUST** be a 4 digit binary number as described below:

| bit | description |
| ----- | ----- |
| MSB | multi-taper estimation |
| 3rd digit | plain FFT |
| 2nd place | magnitude versus time|
| LSB | phase versus time |

Default values are 1000 which means, that by default only the multitaper spectrum is stored. If you are interested in plain FFT and phase data, then you choose 0101.

The last syntax also allows for changing the number of tapers, more tapers can actually be added to the same root file in order to make comparisons if needed. Number of tapers can be one of 2,4,6,8 or 10.

#### The visualizer

This code is actually a ROOT CINT Macro which can either be run in the ROOT interactive session or be compiled. In the interactive session its functions can be used separately. But to access the full functionality regarding the headers, it should be compiled. When compiled, it accepts the names of the histogram followed by the name of the rootfile and plots them on the screen. 

Syntax:

    ./visualizer histo_name file_name

or

    ./visualizer histo_name file_name begin_time end_time

or

    ./visualizer stack file_name

The first one allows for individual plotting of the histograms. The second is the same as the first, but allows selection of time in units of seconds. This is mosly useful when the files are large and one is interested in a portion only. The last syntax uses the keyword **stack**, which causes a plot of stacked histograms made of as many of the 4 CSV channels available.

Proper error handling is provided at the command prompt, e.g. if you provide a wrong histogram name the visualizer will provide you with a list of valid ones actually available in the file.


### Additional Tools


#### read_iqt

This is the old read_iqt program that was in use in previous years and has been provided for convenience here, because it shares most of the code.

#### Comparison tool

This code compares the speed of the two different multi-taper implementations.

